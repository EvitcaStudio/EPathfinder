'use strict';var EasyStar=function(n){function v(l){if(p[l])return p[l].exports;var q=p[l]={i:l,l:!1,exports:{}};return n[l].call(q.exports,q,q.exports,v),q.l=!0,q.exports}var p={};return v.m=n,v.c=p,v.d=function(l,q,B){v.o(l,q)||Object.defineProperty(l,q,{enumerable:!0,get:B})},v.r=function(l){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(l,Symbol.toStringTag,{value:"Module"});Object.defineProperty(l,"__esModule",{value:!0})},v.t=function(l,q){if((1&q&&(l=v(l)),8&q)||4&q&&
"object"==typeof l&&l&&l.__esModule)return l;var B=Object.create(null);if(v.r(B),Object.defineProperty(B,"default",{enumerable:!0,value:l}),2&q&&"string"!=typeof l)for(var A in l)v.d(B,A,function(H){return l[H]}.bind(null,A));return B},v.n=function(l){var q=l&&l.__esModule?function(){return l.default}:function(){return l};return v.d(q,"a",q),q},v.o=function(l,q){return Object.prototype.hasOwnProperty.call(l,q)},v.p="/bin/",v(v.s=0)}([function(n,v,p){var l={},q=p(1),B=p(2),A=p(3);n.exports=l;var H=
1;l.js=function(){var k,D,w,e=!1,G={},I={},E={},J={},K=!0,g={},t=[],m=Number.MAX_VALUE,b=!1;this.setAcceptableTiles=function(c){c instanceof Array?w=c:!isNaN(parseFloat(c))&&isFinite(c)&&(w=[c])};this.enableSync=function(){e=!0};this.disableSync=function(){e=!1};this.enableDiagonals=function(){b=!0};this.disableDiagonals=function(){b=!1};this.setGrid=function(c){k=c;for(c=0;c<k.length;c++)for(var d=0;d<k[0].length;d++)I[k[c][d]]||(I[k[c][d]]=1)};this.setTileCost=function(c,d){I[c]=d};this.setAdditionalPointCost=
function(c,d,a){void 0===E[d]&&(E[d]={});E[d][c]=a};this.removeAdditionalPointCost=function(c,d){void 0!==E[d]&&delete E[d][c]};this.removeAllAdditionalPointCosts=function(){E={}};this.setDirectionalCondition=function(c,d,a){void 0===J[d]&&(J[d]={});J[d][c]=a};this.removeAllDirectionalConditions=function(){J={}};this.setIterationsPerCalculation=function(c){m=c};this.avoidAdditionalPoint=function(c,d){void 0===G[d]&&(G[d]={});G[d][c]=1};this.stopAvoidingAdditionalPoint=function(c,d){void 0!==G[d]&&
delete G[d][c]};this.enableCornerCutting=function(){K=!0};this.disableCornerCutting=function(){K=!1};this.stopAvoidingAllAdditionalPoints=function(){G={}};this.findPath=function(c,d,a,r,x){var C=function(N){e?x(N):setTimeout(function(){x(N)})};if(void 0===w)throw Error("You can't set a path without first calling setAcceptableTiles() on EasyStar.");if(void 0===k)throw Error("You can't set a path without first calling setGrid() on EasyStar.");if(0>c||0>d||0>a||0>r||c>k[0].length-1||d>k.length-1||a>
k[0].length-1||r>k.length-1)throw Error("Your start or end point is outside the scope of your grid.");if(c!==a||d!==r){for(var F=k[r][a],M=!1,L=0;L<w.length;L++)if(F===w[L]){M=!0;break}if(!1!==M)return F=new q,F.openList=new A(function(N,O){return N.bestGuessDistance()-O.bestGuessDistance()}),F.isDoneCalculating=!1,F.nodeHash={},F.startX=c,F.startY=d,F.endX=a,F.endY=r,F.callback=C,F.openList.push(y(F,F.startX,F.startY,null,1)),c=H++,g[c]=F,t.push(c),c;C(null)}else C([])};this.cancelPath=function(c){return c in
g&&(delete g[c],!0)};this.calculate=function(){if(0!==t.length&&void 0!==k&&void 0!==w)for(D=0;D<m&&0!==t.length;D++){e&&(D=0);var c=t[0],d=g[c];if(void 0!==d)if(0!==d.openList.size()){var a=d.openList.pop();if(d.endX!==a.x||d.endY!==a.y)a.list=0,0<a.y&&f(d,a,0,-1,1*z(a.x,a.y-1)),a.x<k[0].length-1&&f(d,a,1,0,1*z(a.x+1,a.y)),a.y<k.length-1&&f(d,a,0,1,1*z(a.x,a.y+1)),0<a.x&&f(d,a,-1,0,1*z(a.x-1,a.y)),b&&(0<a.x&&0<a.y&&(K||h(k,w,a.x,a.y-1,a)&&h(k,w,a.x-1,a.y,a))&&f(d,a,-1,-1,1.4*z(a.x-1,a.y-1)),a.x<
k[0].length-1&&a.y<k.length-1&&(K||h(k,w,a.x,a.y+1,a)&&h(k,w,a.x+1,a.y,a))&&f(d,a,1,1,1.4*z(a.x+1,a.y+1)),a.x<k[0].length-1&&0<a.y&&(K||h(k,w,a.x,a.y-1,a)&&h(k,w,a.x+1,a.y,a))&&f(d,a,1,-1,1.4*z(a.x+1,a.y-1)),0<a.x&&a.y<k.length-1&&(K||h(k,w,a.x,a.y+1,a)&&h(k,w,a.x-1,a.y,a))&&f(d,a,-1,1,1.4*z(a.x-1,a.y+1)));else{var r=[];r.push({x:a.x,y:a.y});for(a=a.parent;null!=a;)r.push({x:a.x,y:a.y}),a=a.parent;r.reverse();d.callback(r);delete g[c];t.shift()}}else d.callback(null),delete g[c],t.shift();else t.shift()}};
var f=function(c,d,a,r,x){a=d.x+a;r=d.y+r;void 0!==G[r]&&void 0!==G[r][a]||!h(k,w,a,r,d)||(r=y(c,a,r,d,x),void 0===r.list?(r.list=1,c.openList.push(r)):d.costSoFar+x<r.costSoFar&&(r.costSoFar=d.costSoFar+x,r.parent=d,c.openList.updateItem(r)))},h=function(c,d,a,r,x){var C=J[r]&&J[r][a];if(C){x=u(x.x-a,x.y-r);a:{for(var F=0;F<C.length;F++)if(C[F]===x){C=!0;break a}C=!1}if(!C)return!1}for(C=0;C<d.length;C++)if(c[r][a]===d[C])return!0;return!1},u=function(c,d){if(0===c&&-1===d)return l.TOP;if(1===c&&
-1===d)return l.TOP_RIGHT;if(1===c&&0===d)return l.RIGHT;if(1===c&&1===d)return l.BOTTOM_RIGHT;if(0===c&&1===d)return l.BOTTOM;if(-1===c&&1===d)return l.BOTTOM_LEFT;if(-1===c&&0===d)return l.LEFT;if(-1===c&&-1===d)return l.TOP_LEFT;throw Error("These differences are not valid: "+c+", "+d);},z=function(c,d){return E[d]&&E[d][c]||I[k[d][c]]},y=function(c,d,a,r,x){if(void 0!==c.nodeHash[a]){if(void 0!==c.nodeHash[a][d])return c.nodeHash[a][d]}else c.nodeHash[a]={};var C=c.endX,F=c.endY,M,L;C=b?(M=Math.abs(d-
C))<(L=Math.abs(a-F))?1.4*M+L:1.4*L+M:Math.abs(d-C)+Math.abs(a-F);r=new B(r,d,a,null!==r?r.costSoFar+x:0,C);return c.nodeHash[a][d]=r,r}};l.TOP="TOP";l.TOP_RIGHT="TOP_RIGHT";l.RIGHT="RIGHT";l.BOTTOM_RIGHT="BOTTOM_RIGHT";l.BOTTOM="BOTTOM";l.BOTTOM_LEFT="BOTTOM_LEFT";l.LEFT="LEFT";l.TOP_LEFT="TOP_LEFT"},function(n,v){n.exports=function(){this.pointsToAvoid={};this.endY=this.endX=this.startY=this.callback=this.startX=void 0;this.nodeHash={};this.openList=void 0}},function(n,v){n.exports=function(p,l,
q,B,A){this.parent=p;this.x=l;this.y=q;this.costSoFar=B;this.simpleDistanceToTarget=A;this.bestGuessDistance=function(){return this.costSoFar+this.simpleDistanceToTarget}}},function(n,v,p){n.exports=p(4)},function(n,v,p){var l,q,B;(function(){var A=Math.floor,H=Math.min,k=function(b,f){return b<f?-1:b>f?1:0},D=function(b,f,h){return null==h&&(h=k),b.push(f),g(b,0,b.length-1,h)},w=function(b,f){var h,u;return null==f&&(f=k),h=b.pop(),b.length?(u=b[0],b[0]=h,t(b,0,f)):u=h,u},e=function(b,f,h){var u;
return null==h&&(h=k),u=b[0],b[0]=f,t(b,0,h),u},G=function(b,f,h){var u;return null==h&&(h=k),b.length&&0>h(b[0],f)&&(f=(u=[b[0],f])[0],b[0]=u[1],t(b,0,h)),f},I=function(b,f){var h,u,z;null==f&&(f=k);var y=[],c=0;for(h=(u=function(){z=[];for(var d=0,a=A(b.length/2);0<=a?d<a:d>a;0<=a?d++:d--)z.push(d);return z}.apply(this).reverse()).length;c<h;c++)y.push(t(b,u[c],f));return y},E=function(b,f,h){if(null==h&&(h=k),-1!==(f=b.indexOf(f)))return g(b,0,f,h),t(b,f,h)},J=function(b,f,h){var u,z;if(null==
h&&(h=k),!(u=b.slice(0,f)).length)return u;I(u,h);var y=0;for(f=(z=b.slice(f)).length;y<f;y++)b=z[y],G(u,b,h);return u.sort(h).reverse()},K=function(b,f,h){var u,z;if(null==h&&(h=k),10*f<=b.length){if(!(z=b.slice(0,f).sort(h)).length)return z;var y=z[z.length-1],c=0;for(b=(f=b.slice(f)).length;c<b;c++)if(0>h(u=f[c],y)){y=void 0;var d=z,a=0,r=null,x=h;if(null==a&&(a=0),null==x&&(x=k),0>a)throw Error("lo must be non-negative");for(null==r&&(r=d.length);a<r;)0>x(u,d[y=A((a+r)/2)])?r=y:a=y+1;[].splice.apply(d,
[a,a-a].concat(u));z.pop();y=z[z.length-1]}return z}I(b,h);y=[];u=0;for(f=H(f,b.length);0<=f?u<f:u>f;0<=f?++u:--u)y.push(w(b,h));return y},g=function(b,f,h,u){var z,y,c;null==u&&(u=k);for(z=b[h];h>f&&0>u(z,y=b[c=h-1>>1]);)b[h]=y,h=c;return b[h]=z},t=function(b,f,h){var u,z;null==h&&(h=k);var y=b.length,c=f,d=b[f];for(u=2*f+1;u<y;)(z=u+1)<y&&!(0>h(b[u],b[z]))&&(u=z),b[f]=b[u],u=2*(f=u)+1;return b[f]=d,g(b,c,f,h)},m=function(){function b(f){this.cmp=null!=f?f:k;this.nodes=[]}return b.push=D,b.pop=w,
b.replace=e,b.pushpop=G,b.heapify=I,b.updateItem=E,b.nlargest=J,b.nsmallest=K,b.prototype.push=function(f){return D(this.nodes,f,this.cmp)},b.prototype.pop=function(){return w(this.nodes,this.cmp)},b.prototype.peek=function(){return this.nodes[0]},b.prototype.contains=function(f){return-1!==this.nodes.indexOf(f)},b.prototype.replace=function(f){return e(this.nodes,f,this.cmp)},b.prototype.pushpop=function(f){return G(this.nodes,f,this.cmp)},b.prototype.heapify=function(){return I(this.nodes,this.cmp)},
b.prototype.updateItem=function(f){return E(this.nodes,f,this.cmp)},b.prototype.clear=function(){return this.nodes=[]},b.prototype.empty=function(){return 0===this.nodes.length},b.prototype.size=function(){return this.nodes.length},b.prototype.clone=function(){var f;return(f=new b).nodes=this.nodes.slice(0),f},b.prototype.toArray=function(){return this.nodes.slice(0)},b.prototype.insert=b.prototype.push,b.prototype.top=b.prototype.peek,b.prototype.front=b.prototype.peek,b.prototype.has=b.prototype.contains,
b.prototype.copy=b.prototype.clone,b}();q=[];void 0===(B="function"==typeof(l=function(){return m})?l.apply(v,q):l)||(n.exports=B)}).call(this)}]);const protoDiob=VYLO.newDiob();
protoDiob.__proto__.constructor.prototype.cancelMove=function(){this.EPathfinderID&&this.easystar&&(this.easystar.cancelPath(this.EPathfinderID),this.easystar.collisionGrid=void 0,this.EPathfinderID=null);this.EPathfinderTrajectory?(this.EPathfinderTrajectory.x=0,this.EPathfinderTrajectory.y=0,this.EPathfinderTrajectory.angle=0,this.EPathfinderTrajectory.lastTime=0,this.EPathfinderTrajectory.deltaTime=0,this.EPathfinderTrajectory.elapsedMS=0,this.EPathfinderTrajectory.nextNodePos=null):this.EPathfinderTrajectory=
{angle:0,x:0,y:0,nextNodePos:null,lastTime:0,deltaTime:0,elapsedMS:0};this.EPathfinderPath=[];this.EPathfinderPathReversed=[];this.EPathfinderMoving=!1;this.moveSettings&&(this.moveSettings.stepSlide=!1,this.moveSettings=this.moveSettings);this.EPathfinderOriginalStepSize&&(this.moveSettings.stepSize=this.EPathfinderOriginalStepSize);this.move();clearInterval(this.EPathfinderTrajectory.interval)};
protoDiob.__proto__.constructor.prototype.goTo=function(n,v,p=!1,l=!1,q=[]){if(this&&this.mapName&&1E4!==this.x&&1E4!==this.y){const w=VYLO.World.getTileSize();var B=VYLO.Map.getMapSize(this.mapName);const e=this;let G=0,I={x:0,y:0};this.easystar||(this.easystar=new EasyStar.js,this.easystar.setIterationsPerCalculation(1E3));var A=VYLO.Map.getLocByPos(Math.round(this.x+this.xOrigin+this.width/2),Math.round(this.y+this.yOrigin+this.height/2),this.mapName);q.includes(A)||(q.push(A),q.push(this));this.cancelMove();
this.moveSettings?(this.moveSettings.stepSlide=!0,this.moveSettings.stepGlide=!0,this.moveSettings=this.moveSettings):this.moveSettings={stepSlide:!0,stepGlide:!0,stepSize:2};this.EPathfinderOriginalStepSize=this.moveSettings.stepSize;this.EPathfinderTrajectory.interval=setInterval(()=>{var g=Date.now();g>this.EPathfinderTrajectory.lastTime&&(this.EPathfinderTrajectory.elapsedMS=g-this.EPathfinderTrajectory.lastTime,66.68<this.EPathfinderTrajectory.elapsedMS&&(this.EPathfinderTrajectory.elapsedMS=
66.68),this.EPathfinderTrajectory.deltaTime=this.EPathfinderTrajectory.elapsedMS/16.67);this.moveSettings.stepSize=this.EPathfinderOriginalStepSize*this.EPathfinderTrajectory.deltaTime;e.easystar.calculate();if(e.EPathfinderPath&&e.EPathfinderPath.length||e.EPathfinderMoving){g={x:Math.round(e.x+e.xOrigin+e.width/2),y:Math.round(e.y+e.yOrigin+e.height/2)};if(this.EPathfinderMoving)if(Math.round(EPathfinder.getDistance(g,e.EPathfinderTrajectory.nextNodePos))<=e.EPathfinderOriginalStepSize){if(e.EPathfinderMoving=
!1,G=0,!e.EPathfinderPath.length){if(e.onPathComplete&&"function"===typeof e.onPathComplete)e.onPathComplete(e.EPathfinderID);e.cancelMove()}}else e.EPathfinderTrajectory.angle=EPathfinder.getAngle(g,e.EPathfinderTrajectory.nextNodePos),e.EPathfinderTrajectory.x=Math.cos(e.EPathfinderTrajectory.angle),e.EPathfinderTrajectory.y=Math.sin(e.EPathfinderTrajectory.angle),e.dir=EPathfinder.getDirFromAngle(-e.EPathfinderTrajectory.angle),e.movePos(e.EPathfinderTrajectory.x,e.EPathfinderTrajectory.y),e.EPathfinderMoving=
!0;else{var t=e.EPathfinderPath.shift();t={x:t.x*w.width-w.width/2,y:t.y*w.height-w.height/2};if(EPathfinder.debugging){const m=VYLO.Map.getLocByPos(t.x,t.y,e.mapName),b=VYLO.newDiob("Overlay");b.atlasName="";b.width=w.width;b.height=w.height;b.color={tint:23295};b.alpha=.8;b.plane=0;b.mouseOpacity=0;b.touchOpacity=0;b.setTransition({alpha:0},-1,3E3);m.addOverlay(b);setTimeout(()=>{m.removeOverlay(b)},3E3)}e.EPathfinderTrajectory.angle=EPathfinder.getAngle(g,t);e.EPathfinderTrajectory.nextNodePos=
t;e.EPathfinderTrajectory.x=Math.cos(e.EPathfinderTrajectory.angle);e.EPathfinderTrajectory.y=Math.sin(e.EPathfinderTrajectory.angle);e.dir=EPathfinder.getDirFromAngle(-e.EPathfinderTrajectory.angle);e.movePos(e.EPathfinderTrajectory.x,e.EPathfinderTrajectory.y);e.EPathfinderMoving=!0;if(EPathfinder.debugging){const m=VYLO.newDiob();m.atlasName="";m.color={tint:16777215};m.width=w.width;m.height=5;m.anchor=0;m.plane=0;m.mouseOpacity=0;m.touchOpacity=0;m.density=0;m.angle=-e.EPathfinderTrajectory.angle;
m.setPos(g.x,g.y,e.mapName);m.setTransition({alpha:0},-1,3E3);setTimeout(()=>{VYLO.delDiob(m)},3E3)}}if(g.x===I.x&&g.y===I.y&&(G++,100<=G&&(e.cancelMove(),e.onPathStuck&&"function"===typeof e.onPathStuck))){e.onPathStuck();return}I=g}this.EPathfinderTrajectory.lastTime=Date.now()},16);this.easystar.setAcceptableTiles([0]);this.easystar.disableDiagonals();this.easystar.disableCornerCutting();this.easystar.setGrid([[]]);p&&(this.easystar.enableDiagonals(),this.easystar.enableCornerCutting());p=EPathfinder.mapTilesToGrid(this.mapName,
q);A=p.acceptedTiles;var H=p.weights;this.easystar.setGrid(p.grid);H.forEach(g=>{e.easystar.setTileCost(g,g)});this.easystar.setAcceptableTiles(A);p=Math.round(this.x+this.xOrigin+this.width/2);A=Math.round(this.y+this.yOrigin+this.height/2);n=EPathfinder.clamp(Math.round(EPathfinder.clamp(n-1,0,B.x))*w.width+w.width/2,0,B.xPos-w.width);v=EPathfinder.clamp(Math.round(EPathfinder.clamp(v-1,0,B.y))*w.height+w.height/2,0,B.yPos-w.height);B=VYLO.Map.getLocByPos(p,A,this.mapName);const E=VYLO.Map.getLocByPos(n,
v,this.mapName);var k=EPathfinder.tileToNode(B);H=EPathfinder.tileToNode(E);if(EPathfinder.debugging){const g=VYLO.newDiob("Overlay");g.atlasName="";g.width=w.width;g.height=w.height;g.color={tint:16777215};g.alpha=.7;g.plane=0;g.touchOpacity=0;g.touchOpacity=0;g.setTransition({alpha:0},-1,3E3);E.addOverlay(g);setTimeout(()=>{E.removeOverlay(g)},3E3)}const J=function(g,t,m,b={left:!1,right:!1,up:!1,down:!1},f){if(g){let h={},u={};for(let y=1;7>y;y++){const c=VYLO.Map.getLocByPos(t-y*w.width/2,m,e.mapName),
d=VYLO.Map.getLocByPos(t+y*w.width/2,m,e.mapName),a=VYLO.Map.getLocByPos(t,m-y*w.height/2,e.mapName),r=VYLO.Map.getLocByPos(t,m+y*w.height/2,e.mapName);!c||b.left||c.density&&!q.includes(c)||c.getContents().filter(x=>{const C=f?EPathfinder.within(e.y+e.yOrigin+e.height,x.y+x.yOrigin,x.yOrigin+x.height):!0;if(x.density&&!q.includes(x)&&C)return x.density}).length?(c&&(u[c.id]=c),1>=y&&(b.left=!0)):h[c.id]=c;!d||b.right||d.density&&!q.includes(d)||d.getContents().filter(x=>{const C=f?EPathfinder.within(e.y+
e.yOrigin+e.height,x.y+x.yOrigin,x.yOrigin+x.height):!0;if(x.density&&!q.includes(x)&&C)return x.density}).length?(d&&(u[d.id]=d),1>=y&&(b.right=!0)):h[d.id]=d;!a||b.up||a.density&&!q.includes(a)||a.getContents().filter(x=>{const C=f?EPathfinder.within(e.x+e.xOrigin+e.width,x.x+x.xOrigin,x.xOrigin+x.width):!0;if(x.density&&!q.includes(x)&&C)return x.density}).length?(a&&(u[a.id]=a),1>=y&&(b.up=!0)):h[a.id]=a;!r||b.down||r.density&&!q.includes(r)||r.getContents().filter(x=>{const C=f?EPathfinder.within(e.x+
e.xOrigin+e.width,x.x+x.xOrigin,x.xOrigin+x.width):!0;if(x.density&&!q.includes(x)&&C)return x.density}).length?(r&&(u[r.id]=r),1>=y&&(b.down=!0)):h[r.id]=r}let z;if(EPathfinder.debugging)for(const y in u){const c=VYLO.newDiob("Overlay");c.color={tint:16711680};c.atlasName="";c.width=w.width;c.height=w.height;c.color={tint:f?16753920:16711680};c.alpha=.3;c.plane=0;c.mouseOpacity=0;c.touchOpacity=0;c.setTransition({alpha:0},-1,3E3);u[y].addOverlay(c);setTimeout(()=>{u[y].removeOverlay(c)},3E3)}for(const y in h){if(EPathfinder.debugging){const c=
VYLO.newDiob("Overlay");c.color={tint:16711680};c.atlasName="";c.width=w.width;c.height=w.height;c.color={tint:f?8900331:65280};c.alpha=.3;c.plane=0;c.mouseOpacity=0;c.touchOpacity=0;c.setTransition({alpha:0},-1,3E3);h[y].addOverlay(c);setTimeout(()=>{h[y].removeOverlay(c)},3E3)}t=EPathfinder.tileToNode(h[y]);z?(m=EPathfinder.getDistance(g,z),EPathfinder.getDistance(g,t)<m&&(z=t)):z=t}return z?z:g}},K=function(g,t,m,b,f){var h=g.x+g.xOrigin+g.width/2;g=g.y+g.yOrigin+g.height/2;return{left:b<=h&&t>=
h,right:b>=h&&t<=h,up:f<=g&&m>=g,down:f>=g&&m<=g}};if(B&&(B.density&&!q.includes(B)||B.getContents().filter(g=>{if(g.density&&!q.includes(g))return g.density}).length)){let g,t={left:!1,right:!1,up:!1,down:!1};if(l){for(var D of B.getContents())D.density&&(g=K(D,p,A,n,v),g.left&&(t.left=!0),g.right&&(t.right=!0),g.up&&(t.up=!0),g.down&&(t.down=!0));D=J(k,p,A,t,!0);t.left&&(k=VYLO.Map.getLocByPos(p+w.width/2,A,e.mapName))&&(k.density&&!q.includes(k)||k.getContents().filter(m=>{if(m.density&&!q.includes(m))return m.density}).length)&&
D.x++;t.right&&(k=VYLO.Map.getLocByPos(p-w.width/2,A,e.mapName))&&(k.density&&!q.includes(k)||k.getContents().filter(m=>{if(m.density&&!q.includes(m))return m.density}).length)&&D.x--;t.up&&(k=VYLO.Map.getLocByPos(p,A+w.height/2,e.mapName))&&(k.density&&!q.includes(k)||k.getContents().filter(m=>{if(m.density&&!q.includes(m))return m.density}).length)&&D.y++;t.down&&(p=VYLO.Map.getLocByPos(p,A-w.height/2,e.mapName))&&(p.density&&!q.includes(p)||p.getContents().filter(m=>{if(m.density&&!q.includes(m))return m.density}).length)&&
D.y--;k=D}if(!l||t.left&&t.right&&t.up&&t.down){if(EPathfinder.debugging){const m=VYLO.newDiob("Overlay");m.atlasName="";m.width=w.width;m.height=w.height;m.color={tint:16711680};m.alpha=.7;m.plane=0;m.touchOpacity=0;m.touchOpacity=0;m.setTransition({alpha:0},-1,3E3);B.addOverlay(m);setTimeout(()=>{E.removeOverlay(m)},3E3)}if(e.onPathNotFound&&"function"===typeof e.onPathNotFound)e.onPathNotFound(B);e.cancelMove();return}}if(E&&(E.density&&!q.includes(E)||E.getContents().filter(g=>{if(g.density&&
!q.includes(g))return g.density}).length)&&(l&&(H=D=J(H,n,v)),!l)){if(e.onPathNotFound&&"function"===typeof e.onPathNotFound)e.onPathNotFound(E);EPathfinder.debugging&&E.getOverlays().filter(g=>{g.color={tint:16711680}});e.cancelMove();return}return this.EPathfinderID=this.easystar.findPath(k.x,k.y,H.x,H.y,g=>{if(g&&g.length){g=g.map(m=>{++m.x;++m.y;return m});const t=[...g].reverse();g.shift();e.EPathfinderPath=g;e.EPathfinderPathReversed=t;if(e.onPathFound&&"function"===typeof e.onPathFound)e.onPathFound([...g],
[...t])}else if(!g||!g.length){if(e.onPathNotFound&&"function"===typeof e.onPathNotFound)e.onPathNotFound();e.cancelMove()}e.easystar.collisionGrid=void 0})}console.error("EPathfinder: No mapName was found on this diob.")};VYLO.delDiob(protoDiob);
class EPathfinderManager{constructor(){this.storedMapTiles={};this.cachedResourcesInfo={}}clamp(n,v,p){return Math.max(v,Math.min(n,p))}within(n,v,p){return n>=v&&n<=p}getAngle(n,v){return Math.atan2(n.y-v.y,n.x-v.x)-Math.PI}getDistance(n,v){const p=n.y-v.y;n=n.x-v.x;return Math.sqrt(n*n+p*p)}getDirFromAngle(n){return"east northeast north northwest west southwest south southeast".split(" ")[Math.floor(180/Math.PI*n/45+.5)%8]}toTwoDimensionalArray(n,v){let p=0;const l=[];for(;p<n.length;)l.push(n.slice(p,
p+=v));return l}mapTilesToGrid(n,v){if(n){if(VYLO.Map.getMaps().includes(n)){let p;const l=[0],q=[],B=VYLO.Map.getMapSize(n);this.storedMapTiles[n]?p=[...this.storedMapTiles[n].tiles]:(p=VYLO.Map.getTiles(n),this.storedMapTiles[n]={tiles:[...p],tiles2d:this.toTwoDimensionalArray([...p],B.x)});p.forEach((A,H)=>{let k=!A.EPathfinderWeight&&0!==A.EPathfinderWeight||"number"!==typeof A.EPathfinderWeight?0:A.EPathfinderWeight;v.includes(A)&&(k=k?k:0);A.density&&!v.includes(A)&&(k=1);for(const D of A.getContents()){if(D.density&&
!v.includes(D)){k=1;break}D.EPathfinderWeight&&"number"===typeof D.EPathfinderWeight&&(k+=D.EPathfinderWeight)}l.includes(k)||1===k||(l.push(k),q.push(k));p[H]=k});return{acceptedTiles:l,grid:this.toTwoDimensionalArray(p,B.x),weights:q}}console.error("EPathfinder: That mapname was not found.")}else console.error("EPathfinder: No mapname was passed.")}getIndexOf2DArray(n,v){for(let p=0;p<n.length;p++){let l=n[p].indexOf(v);if(-1<l)return[p,l]}}tileToNode(n){if(n&&n.mapName){if(this.storedMapTiles[n.mapName])return n=
this.getIndexOf2DArray(this.storedMapTiles[n.mapName].tiles2d,n),{x:n[1],y:n[0]};console.error("EPathfinder: There is no stored grid for the map this tile belongs to.")}}nodeToTile(n,v){return VYLO.Map.getLoc(v.x+1,v.y+1,n)}toggleDebug(){this.debugging=!this.debugging}}("undefined"!==typeof window?window:global).EPathfinder=new EPathfinderManager;