'use strict';(()=>{var Q=function(m){function v(l){if(n[l])return n[l].exports;var p=n[l]={i:l,l:!1,exports:{}};return m[l].call(p.exports,p,p.exports,v),p.l=!0,p.exports}var n={};return v.m=m,v.c=n,v.d=function(l,p,z){v.o(l,p)||Object.defineProperty(l,p,{enumerable:!0,get:z})},v.r=function(l){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(l,Symbol.toStringTag,{value:"Module"});Object.defineProperty(l,"__esModule",{value:!0})},v.t=function(l,p){if((1&p&&(l=v(l)),8&p)||4&p&&
"object"==typeof l&&l&&l.__esModule)return l;var z=Object.create(null);if(v.r(z),Object.defineProperty(z,"default",{enumerable:!0,value:l}),2&p&&"string"!=typeof l)for(var y in l)v.d(z,y,function(H){return l[H]}.bind(null,y));return z},v.n=function(l){var p=l&&l.__esModule?function(){return l.default}:function(){return l};return v.d(p,"a",p),p},v.o=function(l,p){return Object.prototype.hasOwnProperty.call(l,p)},v.p="/bin/",v(v.s=0)}([function(m,v,n){var l={},p=n(1),z=n(2),y=n(3);m.exports=l;var H=
1;l.js=function(){var k,C,u,M=!1,E={},e={},F={},L={},D=!0,K={},G=[],h=Number.MAX_VALUE,c=!1;this.setAcceptableTiles=function(f){f instanceof Array?u=f:!isNaN(parseFloat(f))&&isFinite(f)&&(u=[f])};this.enableSync=function(){M=!0};this.disableSync=function(){M=!1};this.enableDiagonals=function(){c=!0};this.disableDiagonals=function(){c=!1};this.setGrid=function(f){k=f;for(f=0;f<k.length;f++)for(var d=0;d<k[0].length;d++)e[k[f][d]]||(e[k[f][d]]=1)};this.setTileCost=function(f,d){e[f]=d};this.setAdditionalPointCost=
function(f,d,a){void 0===F[d]&&(F[d]={});F[d][f]=a};this.removeAdditionalPointCost=function(f,d){void 0!==F[d]&&delete F[d][f]};this.removeAllAdditionalPointCosts=function(){F={}};this.setDirectionalCondition=function(f,d,a){void 0===L[d]&&(L[d]={});L[d][f]=a};this.removeAllDirectionalConditions=function(){L={}};this.setIterationsPerCalculation=function(f){h=f};this.avoidAdditionalPoint=function(f,d){void 0===E[d]&&(E[d]={});E[d][f]=1};this.stopAvoidingAdditionalPoint=function(f,d){void 0!==E[d]&&
delete E[d][f]};this.enableCornerCutting=function(){D=!0};this.disableCornerCutting=function(){D=!1};this.stopAvoidingAllAdditionalPoints=function(){E={}};this.findPath=function(f,d,a,r,B){var A=function(O){M?B(O):setTimeout(function(){B(O)})};if(void 0===u)throw Error("You can't set a path without first calling setAcceptableTiles() on EasyStar.");if(void 0===k)throw Error("You can't set a path without first calling setGrid() on EasyStar.");if(0>f||0>d||0>a||0>r||f>k[0].length-1||d>k.length-1||a>
k[0].length-1||r>k.length-1)throw Error("Your start or end point is outside the scope of your grid.");if(f!==a||d!==r){for(var q=k[r][a],I=!1,N=0;N<u.length;N++)if(q===u[N]){I=!0;break}if(!1!==I)return q=new p,q.openList=new y(function(O,P){return O.bestGuessDistance()-P.bestGuessDistance()}),q.isDoneCalculating=!1,q.nodeHash={},q.startX=f,q.startY=d,q.endX=a,q.endY=r,q.callback=A,q.openList.push(x(q,q.startX,q.startY,null,1)),f=H++,K[f]=q,G.push(f),f;A(null)}else A([])};this.cancelPath=function(f){return f in
K&&(delete K[f],!0)};this.calculate=function(){if(0!==G.length&&void 0!==k&&void 0!==u)for(C=0;C<h&&0!==G.length;C++){M&&(C=0);var f=G[0],d=K[f];if(void 0!==d)if(0!==d.openList.size()){var a=d.openList.pop();if(d.endX!==a.x||d.endY!==a.y)a.list=0,0<a.y&&b(d,a,0,-1,1*w(a.x,a.y-1)),a.x<k[0].length-1&&b(d,a,1,0,1*w(a.x+1,a.y)),a.y<k.length-1&&b(d,a,0,1,1*w(a.x,a.y+1)),0<a.x&&b(d,a,-1,0,1*w(a.x-1,a.y)),c&&(0<a.x&&0<a.y&&(D||g(k,u,a.x,a.y-1,a)&&g(k,u,a.x-1,a.y,a))&&b(d,a,-1,-1,1.4*w(a.x-1,a.y-1)),a.x<
k[0].length-1&&a.y<k.length-1&&(D||g(k,u,a.x,a.y+1,a)&&g(k,u,a.x+1,a.y,a))&&b(d,a,1,1,1.4*w(a.x+1,a.y+1)),a.x<k[0].length-1&&0<a.y&&(D||g(k,u,a.x,a.y-1,a)&&g(k,u,a.x+1,a.y,a))&&b(d,a,1,-1,1.4*w(a.x+1,a.y-1)),0<a.x&&a.y<k.length-1&&(D||g(k,u,a.x,a.y+1,a)&&g(k,u,a.x-1,a.y,a))&&b(d,a,-1,1,1.4*w(a.x-1,a.y+1)));else{var r=[];r.push({x:a.x,y:a.y});for(a=a.parent;null!=a;)r.push({x:a.x,y:a.y}),a=a.parent;r.reverse();d.callback(r);delete K[f];G.shift()}}else d.callback(null),delete K[f],G.shift();else G.shift()}};
var b=function(f,d,a,r,B){a=d.x+a;r=d.y+r;void 0!==E[r]&&void 0!==E[r][a]||!g(k,u,a,r,d)||(r=x(f,a,r,d,B),void 0===r.list?(r.list=1,f.openList.push(r)):d.costSoFar+B<r.costSoFar&&(r.costSoFar=d.costSoFar+B,r.parent=d,f.openList.updateItem(r)))},g=function(f,d,a,r,B){var A=L[r]&&L[r][a];if(A){B=t(B.x-a,B.y-r);a:{for(var q=0;q<A.length;q++)if(A[q]===B){A=!0;break a}A=!1}if(!A)return!1}for(A=0;A<d.length;A++)if(f[r][a]===d[A])return!0;return!1},t=function(f,d){if(0===f&&-1===d)return l.TOP;if(1===f&&
-1===d)return l.TOP_RIGHT;if(1===f&&0===d)return l.RIGHT;if(1===f&&1===d)return l.BOTTOM_RIGHT;if(0===f&&1===d)return l.BOTTOM;if(-1===f&&1===d)return l.BOTTOM_LEFT;if(-1===f&&0===d)return l.LEFT;if(-1===f&&-1===d)return l.TOP_LEFT;throw Error("These differences are not valid: "+f+", "+d);},w=function(f,d){return F[d]&&F[d][f]||e[k[d][f]]},x=function(f,d,a,r,B){if(void 0!==f.nodeHash[a]){if(void 0!==f.nodeHash[a][d])return f.nodeHash[a][d]}else f.nodeHash[a]={};var A=f.endX,q=f.endY,I,N;A=c?(I=Math.abs(d-
A))<(N=Math.abs(a-q))?1.4*I+N:1.4*N+I:Math.abs(d-A)+Math.abs(a-q);r=new z(r,d,a,null!==r?r.costSoFar+B:0,A);return f.nodeHash[a][d]=r,r}};l.TOP="TOP";l.TOP_RIGHT="TOP_RIGHT";l.RIGHT="RIGHT";l.BOTTOM_RIGHT="BOTTOM_RIGHT";l.BOTTOM="BOTTOM";l.BOTTOM_LEFT="BOTTOM_LEFT";l.LEFT="LEFT";l.TOP_LEFT="TOP_LEFT"},function(m,v){m.exports=function(n,l,p,z,y){this.parent=n;this.x=l;this.y=p;this.costSoFar=z;this.simpleDistanceToTarget=y;this.bestGuessDistance=function(){return this.costSoFar+this.simpleDistanceToTarget}}},
function(m,v,n){m.exports=n(4)},function(m,v,n){var l,p,z;(function(){var y=Math.floor,H=Math.min,k=function(c,b){return c<b?-1:c>b?1:0},C=function(c,b,g){return null==g&&(g=k),c.push(b),K(c,0,c.length-1,g)},u=function(c,b){var g,t;return null==b&&(b=k),g=c.pop(),c.length?(t=c[0],c[0]=g,G(c,0,b)):t=g,t},M=function(c,b,g){var t;return null==g&&(g=k),t=c[0],c[0]=b,G(c,0,g),t},E=function(c,b,g){var t;return null==g&&(g=k),c.length&&0>g(c[0],b)&&(b=(t=[c[0],b])[0],c[0]=t[1],G(c,0,g)),b},e=function(c,
b){var g,t,w;null==b&&(b=k);var x=[],f=0;for(g=(t=function(){w=[];for(var d=0,a=y(c.length/2);0<=a?d<a:d>a;0<=a?d++:d--)w.push(d);return w}.apply(this).reverse()).length;f<g;f++)x.push(G(c,t[f],b));return x},F=function(c,b,g){if(null==g&&(g=k),-1!==(b=c.indexOf(b)))return K(c,0,b,g),G(c,b,g)},L=function(c,b,g){var t,w;if(null==g&&(g=k),!(t=c.slice(0,b)).length)return t;e(t,g);var x=0;for(b=(w=c.slice(b)).length;x<b;x++)c=w[x],E(t,c,g);return t.sort(g).reverse()},D=function(c,b,g){var t,w;if(null==
g&&(g=k),10*b<=c.length){if(!(w=c.slice(0,b).sort(g)).length)return w;var x=w[w.length-1],f=0;for(c=(b=c.slice(b)).length;f<c;f++)if(0>g(t=b[f],x)){x=void 0;var d=w,a=0,r=null,B=g;if(null==a&&(a=0),null==B&&(B=k),0>a)throw Error("lo must be non-negative");for(null==r&&(r=d.length);a<r;)0>B(t,d[x=y((a+r)/2)])?r=x:a=x+1;[].splice.apply(d,[a,a-a].concat(t));w.pop();x=w[w.length-1]}return w}e(c,g);x=[];t=0;for(b=H(b,c.length);0<=b?t<b:t>b;0<=b?++t:--t)x.push(u(c,g));return x},K=function(c,b,g,t){var w,
x,f;null==t&&(t=k);for(w=c[g];g>b&&0>t(w,x=c[f=g-1>>1]);)c[g]=x,g=f;return c[g]=w},G=function(c,b,g){var t,w;null==g&&(g=k);var x=c.length,f=b,d=c[b];for(t=2*b+1;t<x;)(w=t+1)<x&&!(0>g(c[t],c[w]))&&(t=w),c[b]=c[t],t=2*(b=t)+1;return c[b]=d,K(c,f,b,g)},h=function(){function c(b){this.cmp=null!=b?b:k;this.nodes=[]}return c.push=C,c.pop=u,c.replace=M,c.pushpop=E,c.heapify=e,c.updateItem=F,c.nlargest=L,c.nsmallest=D,c.prototype.push=function(b){return C(this.nodes,b,this.cmp)},c.prototype.pop=function(){return u(this.nodes,
this.cmp)},c.prototype.peek=function(){return this.nodes[0]},c.prototype.contains=function(b){return-1!==this.nodes.indexOf(b)},c.prototype.replace=function(b){return M(this.nodes,b,this.cmp)},c.prototype.pushpop=function(b){return E(this.nodes,b,this.cmp)},c.prototype.heapify=function(){return e(this.nodes,this.cmp)},c.prototype.updateItem=function(b){return F(this.nodes,b,this.cmp)},c.prototype.clear=function(){return this.nodes=[]},c.prototype.empty=function(){return 0===this.nodes.length},c.prototype.size=
function(){return this.nodes.length},c.prototype.clone=function(){var b;return(b=new c).nodes=this.nodes.slice(0),b},c.prototype.toArray=function(){return this.nodes.slice(0)},c.prototype.insert=c.prototype.push,c.prototype.top=c.prototype.peek,c.prototype.front=c.prototype.peek,c.prototype.has=c.prototype.contains,c.prototype.copy=c.prototype.clone,c}();p=[];void 0===(z="function"==typeof(l=function(){return h})?l.apply(v,p):l)||(m.exports=z)}).call(this)}]);const J={};VYLO.global.aPathfinder=J;
Diob.cancelMove=function(){this.aPathfinderID&&this.easystar&&(this.easystar.cancelPath(this.aPathfinderID),this.easystar.collisionGrid=void 0,this.aPathfinderID=null);this.aPathfinderTrajectory?(this.aPathfinderTrajectory.x=0,this.aPathfinderTrajectory.y=0,this.aPathfinderTrajectory.angle=0,this.aPathfinderTrajectory.lastTime=0,this.aPathfinderTrajectory.deltaTime=0,this.aPathfinderTrajectory.elapsedMS=0,this.aPathfinderTrajectory.nextNodePos=null):this.aPathfinderTrajectory={angle:0,x:0,y:0,nextNodePos:null,
lastTime:0,deltaTime:0,elapsedMS:0};this.aPathfinderPath=[];this.aPathfinderPathReversed=[];this.aPathfinderMoving=!1;this.moveSettings&&(this.moveSettings.stepSlide=!1,this.moveSettings=this.moveSettings);this.aPathfinderOriginalStepSize&&(this.moveSettings.stepSize=this.aPathfinderOriginalStepSize);this.move();clearInterval(this.aPathfinderTrajectory.interval)};Diob.goTo=function(m,v,n=!1,l=!1,p=[]){if(this&&this.mapName&&1E4!==this.xPos&&1E4!==this.yPos){const u=VYLO.World.getTileSize(),M=VYLO.Client.maxFPS?
1E3/VYLO.Client.maxFPS:16.67,E=4*M;var z=VYLO.Map.getMapSize(this.mapName);const e=this;let F=0,L={x:0,y:0};this.easystar||(this.easystar=new Q.js,this.easystar.setIterationsPerCalculation(1E3));var y=VYLO.Map.getLocByPos(Math.round(this.xPos+this.xOrigin+this.width/2),Math.round(this.yPos+this.yOrigin+this.height/2),this.mapName);p.includes(y)||(p.push(y),p.push(this));this.cancelMove();this.moveSettings?(this.moveSettings.stepSlide=!0,this.moveSettings.stepGlide=!0,this.moveSettings=this.moveSettings):
this.moveSettings={stepSlide:!0,stepGlide:!0,stepSize:2};this.aPathfinderOriginalStepSize=this.moveSettings.stepSize;this.aPathfinderTrajectory.interval=setInterval(()=>{var h=Date.now();h>this.aPathfinderTrajectory.lastTime&&(this.aPathfinderTrajectory.elapsedMS=h-this.aPathfinderTrajectory.lastTime,this.aPathfinderTrajectory.elapsedMS>E&&(this.aPathfinderTrajectory.elapsedMS=E),this.aPathfinderTrajectory.deltaTime=this.aPathfinderTrajectory.elapsedMS/M);this.moveSettings.stepSize=this.aPathfinderOriginalStepSize*
this.aPathfinderTrajectory.deltaTime;e.easystar.calculate();if(e.aPathfinderPath&&e.aPathfinderPath.length||e.aPathfinderMoving){h={x:Math.round(e.xPos+e.xOrigin+e.width/2),y:Math.round(e.yPos+e.yOrigin+e.height/2)};if(this.aPathfinderMoving)if(Math.round(VYLO.global.aPathfinder.getDistance(h,e.aPathfinderTrajectory.nextNodePos))<=e.aPathfinderOriginalStepSize){if(e.aPathfinderMoving=!1,F=0,!e.aPathfinderPath.length){if(e.onPathComplete&&"function"===typeof e.onPathComplete)e.onPathComplete(e.aPathfinderID);
e.cancelMove()}}else e.aPathfinderTrajectory.angle=VYLO.global.aPathfinder.getAngle(h,e.aPathfinderTrajectory.nextNodePos),e.aPathfinderTrajectory.x=Math.cos(e.aPathfinderTrajectory.angle),e.aPathfinderTrajectory.y=Math.sin(e.aPathfinderTrajectory.angle),e.dir=VYLO.global.aPathfinder.getDirFromAngle(-e.aPathfinderTrajectory.angle),e.movePos(e.aPathfinderTrajectory.x,e.aPathfinderTrajectory.y),e.aPathfinderMoving=!0;else{var c=e.aPathfinderPath.shift();c={x:c.x*u.width-u.width/2,y:c.y*u.height-u.height/
2};if(VYLO.global.aPathfinder.debugging){const b=VYLO.Map.getLocByPos(c.x,c.y,e.mapName),g=VYLO.newDiob("Overlay");g.atlasName="";g.width=u.width;g.height=u.height;g.color={tint:23295};g.alpha=.8;g.plane=0;g.mouseOpacity=0;g.touchOpacity=0;g.setTransition({alpha:0},-1,3E3);b.addOverlay(g);setTimeout(()=>{b.removeOverlay(g)},3E3)}e.aPathfinderTrajectory.angle=VYLO.global.aPathfinder.getAngle(h,c);e.aPathfinderTrajectory.nextNodePos=c;e.aPathfinderTrajectory.x=Math.cos(e.aPathfinderTrajectory.angle);
e.aPathfinderTrajectory.y=Math.sin(e.aPathfinderTrajectory.angle);e.dir=VYLO.global.aPathfinder.getDirFromAngle(-e.aPathfinderTrajectory.angle);e.movePos(e.aPathfinderTrajectory.x,e.aPathfinderTrajectory.y);e.aPathfinderMoving=!0;if(VYLO.global.aPathfinder.debugging){const b=VYLO.newDiob();b.atlasName="";b.color={tint:16777215};b.width=u.width;b.height=5;b.anchor=0;b.plane=0;b.mouseOpacity=0;b.touchOpacity=0;b.density=0;b.angle=-e.aPathfinderTrajectory.angle;b.setPos(h.x,h.y,e.mapName);b.setTransition({alpha:0},
-1,3E3);setTimeout(()=>{VYLO.delDiob(b)},3E3)}}if(h.x===L.x&&h.y===L.y&&(F++,100<=F&&(e.cancelMove(),e.onPathStuck&&"function"===typeof e.onPathStuck))){e.onPathStuck();return}L=h}this.aPathfinderTrajectory.lastTime=Date.now()},16);this.easystar.setAcceptableTiles([0]);this.easystar.disableDiagonals();this.easystar.disableCornerCutting();this.easystar.setGrid([[]]);n&&(this.easystar.enableDiagonals(),this.easystar.enableCornerCutting());n=VYLO.global.aPathfinder.mapTilesToGrid(this.mapName,p);y=n.acceptedTiles;
var H=n.weights;this.easystar.setGrid(n.grid);H.forEach(h=>{e.easystar.setTileCost(h,h)});this.easystar.setAcceptableTiles(y);n=Math.round(this.xPos+this.xOrigin+this.width/2);y=Math.round(this.yPos+this.yOrigin+this.height/2);m=VYLO.global.aPathfinder.clamp(Math.round(VYLO.global.aPathfinder.clamp(m-1,0,z.x))*u.width+u.width/2,0,z.xPos-u.width);v=VYLO.global.aPathfinder.clamp(Math.round(VYLO.global.aPathfinder.clamp(v-1,0,z.y))*u.height+u.height/2,0,z.yPos-u.height);z=VYLO.Map.getLocByPos(n,y,this.mapName);
const D=VYLO.Map.getLocByPos(m,v,this.mapName);var k=VYLO.global.aPathfinder.tileToNode(z);H=VYLO.global.aPathfinder.tileToNode(D);if(VYLO.global.aPathfinder.debugging){const h=VYLO.newDiob("Overlay");h.atlasName="";h.width=u.width;h.height=u.height;h.color={tint:16777215};h.alpha=.7;h.plane=0;h.touchOpacity=0;h.touchOpacity=0;h.setTransition({alpha:0},-1,3E3);D.addOverlay(h);setTimeout(()=>{D.removeOverlay(h)},3E3)}const K=function(h,c,b,g={left:!1,right:!1,up:!1,down:!1},t){if(h){let w={},x={};
for(let d=1;7>d;d++){const a=VYLO.Map.getLocByPos(c-d*u.width/2,b,e.mapName),r=VYLO.Map.getLocByPos(c+d*u.width/2,b,e.mapName),B=VYLO.Map.getLocByPos(c,b-d*u.height/2,e.mapName),A=VYLO.Map.getLocByPos(c,b+d*u.height/2,e.mapName);!a||g.left||a.density&&!p.includes(a)||a.getContents().filter(q=>{const I=t?VYLO.global.aPathfinder.within(e.yPos+e.yOrigin+e.height,q.yPos+q.yOrigin,q.yOrigin+q.height):!0;if(q.density&&!p.includes(q)&&I)return q.density}).length?(a&&(x[a.id]=a),1>=d&&(g.left=!0)):w[a.id]=
a;!r||g.right||r.density&&!p.includes(r)||r.getContents().filter(q=>{const I=t?VYLO.global.aPathfinder.within(e.yPos+e.yOrigin+e.height,q.yPos+q.yOrigin,q.yOrigin+q.height):!0;if(q.density&&!p.includes(q)&&I)return q.density}).length?(r&&(x[r.id]=r),1>=d&&(g.right=!0)):w[r.id]=r;!B||g.up||B.density&&!p.includes(B)||B.getContents().filter(q=>{const I=t?VYLO.global.aPathfinder.within(e.xPos+e.xOrigin+e.width,q.xPos+q.xOrigin,q.xOrigin+q.width):!0;if(q.density&&!p.includes(q)&&I)return q.density}).length?
(B&&(x[B.id]=B),1>=d&&(g.up=!0)):w[B.id]=B;!A||g.down||A.density&&!p.includes(A)||A.getContents().filter(q=>{const I=t?VYLO.global.aPathfinder.within(e.xPos+e.xOrigin+e.width,q.xPos+q.xOrigin,q.xOrigin+q.width):!0;if(q.density&&!p.includes(q)&&I)return q.density}).length?(A&&(x[A.id]=A),1>=d&&(g.down=!0)):w[A.id]=A}let f;if(VYLO.global.aPathfinder.debugging)for(const d in x){const a=VYLO.newDiob("Overlay");a.color={tint:16711680};a.atlasName="";a.width=u.width;a.height=u.height;a.color={tint:t?16753920:
16711680};a.alpha=.3;a.plane=0;a.mouseOpacity=0;a.touchOpacity=0;a.setTransition({alpha:0},-1,3E3);x[d].addOverlay(a);setTimeout(()=>{x[d].removeOverlay(a)},3E3)}for(const d in w){if(VYLO.global.aPathfinder.debugging){const a=VYLO.newDiob("Overlay");a.color={tint:16711680};a.atlasName="";a.width=u.width;a.height=u.height;a.color={tint:t?8900331:65280};a.alpha=.3;a.plane=0;a.mouseOpacity=0;a.touchOpacity=0;a.setTransition({alpha:0},-1,3E3);w[d].addOverlay(a);setTimeout(()=>{w[d].removeOverlay(a)},
3E3)}c=VYLO.global.aPathfinder.tileToNode(w[d]);f?(b=VYLO.global.aPathfinder.getDistance(h,f),VYLO.global.aPathfinder.getDistance(h,c)<b&&(f=c)):f=c}return f?f:h}},G=function(h,c,b,g,t){var w=h.xPos+h.xOrigin+h.width/2;h=h.yPos+h.yOrigin+h.height/2;return{left:g<=w&&c>=w,right:g>=w&&c<=w,up:t<=h&&b>=h,down:t>=h&&b<=h}};if(z&&(z.density&&!p.includes(z)||z.getContents().filter(h=>{if(h.density&&!p.includes(h))return h.density}).length)){let h,c={left:!1,right:!1,up:!1,down:!1};if(l){for(var C of z.getContents())C.density&&
(h=G(C,n,y,m,v),h.left&&(c.left=!0),h.right&&(c.right=!0),h.up&&(c.up=!0),h.down&&(c.down=!0));C=K(k,n,y,c,!0);c.left&&(k=VYLO.Map.getLocByPos(n+u.width/2,y,e.mapName))&&(k.density&&!p.includes(k)||k.getContents().filter(b=>{if(b.density&&!p.includes(b))return b.density}).length)&&C.x++;c.right&&(k=VYLO.Map.getLocByPos(n-u.width/2,y,e.mapName))&&(k.density&&!p.includes(k)||k.getContents().filter(b=>{if(b.density&&!p.includes(b))return b.density}).length)&&C.x--;c.up&&(k=VYLO.Map.getLocByPos(n,y+u.height/
2,e.mapName))&&(k.density&&!p.includes(k)||k.getContents().filter(b=>{if(b.density&&!p.includes(b))return b.density}).length)&&C.y++;c.down&&(n=VYLO.Map.getLocByPos(n,y-u.height/2,e.mapName))&&(n.density&&!p.includes(n)||n.getContents().filter(b=>{if(b.density&&!p.includes(b))return b.density}).length)&&C.y--;k=C}if(!l||c.left&&c.right&&c.up&&c.down){if(VYLO.global.aPathfinder.debugging){const b=VYLO.newDiob("Overlay");b.atlasName="";b.width=u.width;b.height=u.height;b.color={tint:16711680};b.alpha=
.7;b.plane=0;b.touchOpacity=0;b.touchOpacity=0;b.setTransition({alpha:0},-1,3E3);z.addOverlay(b);setTimeout(()=>{D.removeOverlay(b)},3E3)}if(e.onPathNotFound&&"function"===typeof e.onPathNotFound)e.onPathNotFound(z);e.cancelMove();return}}if(D&&(D.density&&!p.includes(D)||D.getContents().filter(h=>{if(h.density&&!p.includes(h))return h.density}).length)&&(l&&(H=C=K(H,m,v)),!l)){if(e.onPathNotFound&&"function"===typeof e.onPathNotFound)e.onPathNotFound(D);VYLO.global.aPathfinder.debugging&&D.getOverlays().filter(h=>
{h.color={tint:16711680}});e.cancelMove();return}return this.aPathfinderID=this.easystar.findPath(k.x,k.y,H.x,H.y,h=>{if(h&&h.length){h=h.map(b=>{++b.x;++b.y;return b});const c=[...h].reverse();h.shift();e.aPathfinderPath=h;e.aPathfinderPathReversed=c;if(e.onPathFound&&"function"===typeof e.onPathFound)e.onPathFound([...h],[...c])}else if(!h||!h.length){if(e.onPathNotFound&&"function"===typeof e.onPathNotFound)e.onPathNotFound();e.cancelMove()}e.easystar.collisionGrid=void 0})}console.error("aPathfinder: No mapName was found on this diob.")};
J.storedMapTiles={};J.cachedResourcesInfo={};J.clamp=(m,v,n)=>Math.max(v,Math.min(m,n));J.within=function(m,v,n){return m>=v&&m<=n};J.getAngle=function(m,v){return Math.atan2(m.y-v.y,m.x-v.x)-Math.PI};J.getDistance=(m,v)=>{const n=m.y-v.y;m=m.x-v.x;return Math.sqrt(m*m+n*n)};J.getDirFromAngle=function(m){return"east northeast north northwest west southwest south southeast".split(" ")[Math.floor(180/Math.PI*m/45+.5)%8]};J.toTwoDimensionalArray=function(m,v){let n=0;const l=[];for(;n<m.length;)l.push(m.slice(n,
n+=v));return l};J.mapTilesToGrid=function(m,v){if(m){if(VYLO.Map.getMaps().includes(m)){let n;const l=[0],p=[],z=VYLO.Map.getMapSize(m);this.storedMapTiles[m]?n=[...this.storedMapTiles[m].tiles]:(n=VYLO.Map.getTiles(m),this.storedMapTiles[m]={tiles:[...n],tiles2d:this.toTwoDimensionalArray([...n],z.x)});n.forEach((y,H)=>{let k=!y.aPathfindingWeight&&0!==y.aPathfindingWeight||"number"!==typeof y.aPathfindingWeight?0:y.aPathfindingWeight;v.includes(y)&&(k=k?k:0);y.density&&!v.includes(y)&&(k=1);for(const C of y.getContents()){if(C.density&&
!v.includes(C)){k=1;break}C.aPathfindingWeight&&"number"===typeof C.aPathfindingWeight&&(k+=C.aPathfindingWeight)}l.includes(k)||1===k||(l.push(k),p.push(k));n[H]=k});return{acceptedTiles:l,grid:this.toTwoDimensionalArray(n,z.x),weights:p}}console.error("aPathfinder: That mapname was not found.")}else console.error("aPathfinder: No mapname was passed.")};J.getIndexOf2DArray=function(m,v){for(let n=0;n<m.length;n++){let l=m[n].indexOf(v);if(-1<l)return[n,l]}};J.tileToNode=function(m){if(m&&m.mapName){if(this.storedMapTiles[m.mapName])return m=
this.getIndexOf2DArray(this.storedMapTiles[m.mapName].tiles2d,m),{x:m[1],y:m[0]};console.error("aPathfinder: There is no stored grid for the map this tile belongs to.")}};J.nodeToTile=function(m,v){return VYLO.Map.getLoc(v.x+1,v.y+1,m)};J.toggleDebug=function(){this.debugging=!this.debugging}})();