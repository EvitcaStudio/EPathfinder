/*
 @license
 The MIT License (MIT)

 Copyright (c) 2012-2020 Bryce Neal

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to deal
 in the Software without restriction, including without limitation the rights
 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in
 all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 THE SOFTWARE.
*/
'use strict';(()=>{var Q=function(n){function u(l){if(p[l])return p[l].exports;var q=p[l]={i:l,l:!1,exports:{}};return n[l].call(q.exports,q,q.exports,u),q.l=!0,q.exports}var p={};return u.m=n,u.c=p,u.d=function(l,q,z){u.o(l,q)||Object.defineProperty(l,q,{enumerable:!0,get:z})},u.r=function(l){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(l,Symbol.toStringTag,{value:"Module"});Object.defineProperty(l,"__esModule",{value:!0})},u.t=function(l,q){if((1&q&&(l=u(l)),8&q)||4&q&&
"object"==typeof l&&l&&l.__esModule)return l;var z=Object.create(null);if(u.r(z),Object.defineProperty(z,"default",{enumerable:!0,value:l}),2&q&&"string"!=typeof l)for(var y in l)u.d(z,y,function(F){return l[F]}.bind(null,y));return z},u.n=function(l){var q=l&&l.__esModule?function(){return l.default}:function(){return l};return u.d(q,"a",q),q},u.o=function(l,q){return Object.prototype.hasOwnProperty.call(l,q)},u.p="/bin/",u(u.s=0)}([function(n,u,p){var l={},q=p(1),z=p(2),y=p(3);n.exports=l;var F=
1;l.js=function(){var k,C,v,L=!1,G={},e={},E={},J={},D=!0,M={},K=[],g=Number.MAX_VALUE,w=!1;this.setAcceptableTiles=function(f){f instanceof Array?v=f:!isNaN(parseFloat(f))&&isFinite(f)&&(v=[f])};this.enableSync=function(){L=!0};this.disableSync=function(){L=!1};this.enableDiagonals=function(){w=!0};this.disableDiagonals=function(){w=!1};this.setGrid=function(f){k=f;for(f=0;f<k.length;f++)for(var c=0;c<k[0].length;c++)e[k[f][c]]||(e[k[f][c]]=1)};this.setTileCost=function(f,c){e[f]=c};this.setAdditionalPointCost=
function(f,c,b){void 0===E[c]&&(E[c]={});E[c][f]=b};this.removeAdditionalPointCost=function(f,c){void 0!==E[c]&&delete E[c][f]};this.removeAllAdditionalPointCosts=function(){E={}};this.setDirectionalCondition=function(f,c,b){void 0===J[c]&&(J[c]={});J[c][f]=b};this.removeAllDirectionalConditions=function(){J={}};this.setIterationsPerCalculation=function(f){g=f};this.avoidAdditionalPoint=function(f,c){void 0===G[c]&&(G[c]={});G[c][f]=1};this.stopAvoidingAdditionalPoint=function(f,c){void 0!==G[c]&&
delete G[c][f]};this.enableCornerCutting=function(){D=!0};this.disableCornerCutting=function(){D=!1};this.stopAvoidingAllAdditionalPoints=function(){G={}};this.findPath=function(f,c,b,t,B){var A=function(O){L?B(O):setTimeout(function(){B(O)})};if(void 0===v)throw Error("You can't set a path without first calling setAcceptableTiles() on EasyStar.");if(void 0===k)throw Error("You can't set a path without first calling setGrid() on EasyStar.");if(0>f||0>c||0>b||0>t||f>k[0].length-1||c>k.length-1||b>
k[0].length-1||t>k.length-1)throw Error("Your start or end point is outside the scope of your grid.");if(f!==b||c!==t){for(var r=k[t][b],H=!1,N=0;N<v.length;N++)if(r===v[N]){H=!0;break}if(!1!==H)return r=new q,r.openList=new y(function(O,P){return O.bestGuessDistance()-P.bestGuessDistance()}),r.isDoneCalculating=!1,r.nodeHash={},r.startX=f,r.startY=c,r.endX=b,r.endY=t,r.callback=A,r.openList.push(x(r,r.startX,r.startY,null,1)),f=F++,M[f]=r,K.push(f),f;A(null)}else A([])};this.cancelPath=function(f){return f in
M&&(delete M[f],!0)};this.calculate=function(){if(0!==K.length&&void 0!==k&&void 0!==v)for(C=0;C<g&&0!==K.length;C++){L&&(C=0);var f=K[0],c=M[f];if(void 0!==c)if(0!==c.openList.size()){var b=c.openList.pop();if(c.endX!==b.x||c.endY!==b.y)b.list=0,0<b.y&&a(c,b,0,-1,1*m(b.x,b.y-1)),b.x<k[0].length-1&&a(c,b,1,0,1*m(b.x+1,b.y)),b.y<k.length-1&&a(c,b,0,1,1*m(b.x,b.y+1)),0<b.x&&a(c,b,-1,0,1*m(b.x-1,b.y)),w&&(0<b.x&&0<b.y&&(D||d(k,v,b.x,b.y-1,b)&&d(k,v,b.x-1,b.y,b))&&a(c,b,-1,-1,1.4*m(b.x-1,b.y-1)),b.x<
k[0].length-1&&b.y<k.length-1&&(D||d(k,v,b.x,b.y+1,b)&&d(k,v,b.x+1,b.y,b))&&a(c,b,1,1,1.4*m(b.x+1,b.y+1)),b.x<k[0].length-1&&0<b.y&&(D||d(k,v,b.x,b.y-1,b)&&d(k,v,b.x+1,b.y,b))&&a(c,b,1,-1,1.4*m(b.x+1,b.y-1)),0<b.x&&b.y<k.length-1&&(D||d(k,v,b.x,b.y+1,b)&&d(k,v,b.x-1,b.y,b))&&a(c,b,-1,1,1.4*m(b.x-1,b.y+1)));else{var t=[];t.push({x:b.x,y:b.y});for(b=b.parent;null!=b;)t.push({x:b.x,y:b.y}),b=b.parent;t.reverse();c.callback(t);delete M[f];K.shift()}}else c.callback(null),delete M[f],K.shift();else K.shift()}};
var a=function(f,c,b,t,B){b=c.x+b;t=c.y+t;void 0!==G[t]&&void 0!==G[t][b]||!d(k,v,b,t,c)||(t=x(f,b,t,c,B),void 0===t.list?(t.list=1,f.openList.push(t)):c.costSoFar+B<t.costSoFar&&(t.costSoFar=c.costSoFar+B,t.parent=c,f.openList.updateItem(t)))},d=function(f,c,b,t,B){var A=J[t]&&J[t][b];if(A){B=h(B.x-b,B.y-t);a:{for(var r=0;r<A.length;r++)if(A[r]===B){A=!0;break a}A=!1}if(!A)return!1}for(A=0;A<c.length;A++)if(f[t][b]===c[A])return!0;return!1},h=function(f,c){if(0===f&&-1===c)return l.TOP;if(1===f&&
-1===c)return l.TOP_RIGHT;if(1===f&&0===c)return l.RIGHT;if(1===f&&1===c)return l.BOTTOM_RIGHT;if(0===f&&1===c)return l.BOTTOM;if(-1===f&&1===c)return l.BOTTOM_LEFT;if(-1===f&&0===c)return l.LEFT;if(-1===f&&-1===c)return l.TOP_LEFT;throw Error("These differences are not valid: "+f+", "+c);},m=function(f,c){return E[c]&&E[c][f]||e[k[c][f]]},x=function(f,c,b,t,B){if(void 0!==f.nodeHash[b]){if(void 0!==f.nodeHash[b][c])return f.nodeHash[b][c]}else f.nodeHash[b]={};var A=f.endX;var r=f.endY,H,N;A=w?(H=
Math.abs(c-A))<(N=Math.abs(b-r))?1.4*H+N:1.4*N+H:Math.abs(c-A)+Math.abs(b-r);t=new z(t,c,b,null!==t?t.costSoFar+B:0,A);return f.nodeHash[b][c]=t,t}};l.TOP="TOP";l.TOP_RIGHT="TOP_RIGHT";l.RIGHT="RIGHT";l.BOTTOM_RIGHT="BOTTOM_RIGHT";l.BOTTOM="BOTTOM";l.BOTTOM_LEFT="BOTTOM_LEFT";l.LEFT="LEFT";l.TOP_LEFT="TOP_LEFT"},function(n,u){n.exports=function(){this.pointsToAvoid={};this.endY=this.endX=this.startY=this.callback=this.startX=void 0;this.nodeHash={};this.openList=void 0}},function(n,u){n.exports=function(p,
l,q,z,y){this.parent=p;this.x=l;this.y=q;this.costSoFar=z;this.simpleDistanceToTarget=y;this.bestGuessDistance=function(){return this.costSoFar+this.simpleDistanceToTarget}}},function(n,u,p){n.exports=p(4)},function(n,u,p){var l,q,z;(function(){var y=Math.floor;var F=Math.min;var k=function(a,d){return a<d?-1:a>d?1:0};var C=function(a,d,h,m,x){var f;if(null==h&&(h=0),null==x&&(x=k),0>h)throw Error("lo must be non-negative");for(null==m&&(m=a.length);h<m;)0>x(d,a[f=y((h+m)/2)])?m=f:h=f+1;return[].splice.apply(a,
[h,h-h].concat(d)),d};var v=function(a,d,h){return null==h&&(h=k),a.push(d),K(a,0,a.length-1,h)};var L=function(a,d){var h,m;return null==d&&(d=k),h=a.pop(),a.length?(m=a[0],a[0]=h,g(a,0,d)):m=h,m};var G=function(a,d,h){var m;return null==h&&(h=k),m=a[0],a[0]=d,g(a,0,h),m};var e=function(a,d,h){var m;return null==h&&(h=k),a.length&&0>h(a[0],d)&&(d=(m=[a[0],d])[0],a[0]=m[1],g(a,0,h)),d};var E=function(a,d){var h,m,x;null==d&&(d=k);var f=[];var c=0;for(h=(m=function(){x=[];for(var t=0,B=y(a.length/
2);0<=B?t<B:t>B;0<=B?t++:t--)x.push(t);return x}.apply(this).reverse()).length;c<h;c++){var b=m[c];f.push(g(a,b,d))}return f};var J=function(a,d,h){if(null==h&&(h=k),-1!==(d=a.indexOf(d)))return K(a,0,d,h),g(a,d,h)};var D=function(a,d,h){var m,x;if(null==h&&(h=k),!(m=a.slice(0,d)).length)return m;E(m,h);var f=0;for(d=(x=a.slice(d)).length;f<d;f++)a=x[f],e(m,a,h);return m.sort(h).reverse()};var M=function(a,d,h){var m,x;if(null==h&&(h=k),10*d<=a.length){if(!(x=a.slice(0,d).sort(h)).length)return x;
var f=x[x.length-1];var c=0;for(a=(d=a.slice(d)).length;c<a;c++)0>h(m=d[c],f)&&(C(x,m,0,null,h),x.pop(),f=x[x.length-1]);return x}E(a,h);f=[];m=0;for(d=F(d,a.length);0<=d?m<d:m>d;0<=d?++m:--m)f.push(L(a,h));return f};var K=function(a,d,h,m){var x,f,c;null==m&&(m=k);for(x=a[h];h>d&&0>m(x,f=a[c=h-1>>1]);)a[h]=f,h=c;return a[h]=x};var g=function(a,d,h){var m,x;null==h&&(h=k);var f=a.length;var c=d;var b=a[d];for(m=2*d+1;m<f;)(x=m+1)<f&&!(0>h(a[m],a[x]))&&(m=x),a[d]=a[m],m=2*(d=m)+1;return a[d]=b,K(a,
c,d,h)};var w=function(){function a(d){this.cmp=null!=d?d:k;this.nodes=[]}return a.push=v,a.pop=L,a.replace=G,a.pushpop=e,a.heapify=E,a.updateItem=J,a.nlargest=D,a.nsmallest=M,a.prototype.push=function(d){return v(this.nodes,d,this.cmp)},a.prototype.pop=function(){return L(this.nodes,this.cmp)},a.prototype.peek=function(){return this.nodes[0]},a.prototype.contains=function(d){return-1!==this.nodes.indexOf(d)},a.prototype.replace=function(d){return G(this.nodes,d,this.cmp)},a.prototype.pushpop=function(d){return e(this.nodes,
d,this.cmp)},a.prototype.heapify=function(){return E(this.nodes,this.cmp)},a.prototype.updateItem=function(d){return J(this.nodes,d,this.cmp)},a.prototype.clear=function(){return this.nodes=[]},a.prototype.empty=function(){return 0===this.nodes.length},a.prototype.size=function(){return this.nodes.length},a.prototype.clone=function(){var d;return(d=new a).nodes=this.nodes.slice(0),d},a.prototype.toArray=function(){return this.nodes.slice(0)},a.prototype.insert=a.prototype.push,a.prototype.top=a.prototype.peek,
a.prototype.front=a.prototype.peek,a.prototype.has=a.prototype.contains,a.prototype.copy=a.prototype.clone,a}();q=[];void 0===(z="function"==typeof(l=function(){return w})?l.apply(u,q):l)||(n.exports=z)}).call(this)}]);const I={};VYLO.global.aPathfinder=I;Diob.prototype.cancelMove=function(){this.aPathfinderID&&this.easystar&&(this.easystar.cancelPath(this.aPathfinderID),this.easystar.collisionGrid=void 0,this.aPathfinderID=null);this.aPathfinderTrajectory?(this.aPathfinderTrajectory.x=0,this.aPathfinderTrajectory.y=
0,this.aPathfinderTrajectory.angle=0,this.aPathfinderTrajectory.lastTime=0,this.aPathfinderTrajectory.deltaTime=0,this.aPathfinderTrajectory.elapsedMS=0,this.aPathfinderTrajectory.nextNodePos=null):this.aPathfinderTrajectory={angle:0,x:0,y:0,nextNodePos:null,lastTime:0,deltaTime:0,elapsedMS:0};this.aPathfinderPath=[];this.aPathfinderPathReversed=[];this.aPathfinderMoving=!1;this.moveSettings&&(this.moveSettings.stepSlide=!1,this.moveSettings=this.moveSettings);this.aPathfinderOriginalStepSize&&(this.moveSettings.stepSize=
this.aPathfinderOriginalStepSize);this.move();clearInterval(this.aPathfinderTrajectory.interval)};Diob.prototype.goTo=function(n,u,p=!1,l=!1,q=[]){if(this&&this.mapName&&1E4!==this.xPos&&1E4!==this.yPos){const v=VYLO.World.getTileSize(),L=VYLO.Client.maxFPS?1E3/VYLO.Client.maxFPS:16.67,G=4*L;var z=VYLO.Map.getMapSize(this.mapName);const e=this;let E=0,J={x:0,y:0};this.easystar||(this.easystar=new Q.js,this.easystar.setIterationsPerCalculation(1E3));var y=VYLO.Map.getLocByPos(Math.round(this.xPos+
this.xOrigin+this.width/2),Math.round(this.yPos+this.yOrigin+this.height/2),this.mapName);q.includes(y)||(q.push(y),q.push(this));this.cancelMove();this.moveSettings?(this.moveSettings.stepSlide=!0,this.moveSettings.stepGlide=!0,this.moveSettings=this.moveSettings):this.moveSettings={stepSlide:!0,stepGlide:!0,stepSize:2};this.aPathfinderOriginalStepSize=this.moveSettings.stepSize;this.aPathfinderTrajectory.interval=setInterval(()=>{var g=Date.now();g>this.aPathfinderTrajectory.lastTime&&(this.aPathfinderTrajectory.elapsedMS=
g-this.aPathfinderTrajectory.lastTime,this.aPathfinderTrajectory.elapsedMS>G&&(this.aPathfinderTrajectory.elapsedMS=G),this.aPathfinderTrajectory.deltaTime=this.aPathfinderTrajectory.elapsedMS/L);this.moveSettings.stepSize=this.aPathfinderOriginalStepSize*this.aPathfinderTrajectory.deltaTime;e.easystar.calculate();if(e.aPathfinderPath&&e.aPathfinderPath.length||e.aPathfinderMoving){g={x:Math.round(e.xPos+e.xOrigin+e.width/2),y:Math.round(e.yPos+e.yOrigin+e.height/2)};if(this.aPathfinderMoving)if(Math.round(VYLO.global.aPathfinder.getDistance(g,
e.aPathfinderTrajectory.nextNodePos))<=e.aPathfinderOriginalStepSize){if(e.aPathfinderMoving=!1,E=0,!e.aPathfinderPath.length){if(e.onPathComplete&&"function"===typeof e.onPathComplete)e.onPathComplete(e.aPathfinderID);e.cancelMove()}}else e.aPathfinderTrajectory.angle=VYLO.global.aPathfinder.getAngle(g,e.aPathfinderTrajectory.nextNodePos),e.aPathfinderTrajectory.x=Math.cos(e.aPathfinderTrajectory.angle),e.aPathfinderTrajectory.y=Math.sin(e.aPathfinderTrajectory.angle),e.dir=VYLO.global.aPathfinder.getDirFromAngle(-e.aPathfinderTrajectory.angle),
e.movePos(e.aPathfinderTrajectory.x,e.aPathfinderTrajectory.y),e.aPathfinderMoving=!0;else{var w=e.aPathfinderPath.shift();w={x:w.x*v.width-v.width/2,y:w.y*v.height-v.height/2};if(VYLO.global.aPathfinder.debugging){const a=VYLO.Map.getLocByPos(w.x,w.y,e.mapName),d=VYLO.newDiob("Overlay");d.atlasName="";d.width=v.width;d.height=v.height;d.color={tint:23295};d.alpha=.8;d.plane=0;d.mouseOpacity=0;d.touchOpacity=0;d.setTransition({alpha:0},-1,3E3);a.addOverlay(d);setTimeout(()=>{a.removeOverlay(d)},3E3)}e.aPathfinderTrajectory.angle=
VYLO.global.aPathfinder.getAngle(g,w);e.aPathfinderTrajectory.nextNodePos=w;e.aPathfinderTrajectory.x=Math.cos(e.aPathfinderTrajectory.angle);e.aPathfinderTrajectory.y=Math.sin(e.aPathfinderTrajectory.angle);e.dir=VYLO.global.aPathfinder.getDirFromAngle(-e.aPathfinderTrajectory.angle);e.movePos(e.aPathfinderTrajectory.x,e.aPathfinderTrajectory.y);e.aPathfinderMoving=!0;if(VYLO.global.aPathfinder.debugging){const a=VYLO.newDiob();a.atlasName="";a.color={tint:16777215};a.width=v.width;a.height=5;a.anchor=
0;a.plane=0;a.mouseOpacity=0;a.touchOpacity=0;a.density=0;a.angle=-e.aPathfinderTrajectory.angle;a.setPos(g.x,g.y,e.mapName);a.setTransition({alpha:0},-1,3E3);setTimeout(()=>{VYLO.delDiob(a)},3E3)}}if(g.x===J.x&&g.y===J.y&&(E++,100<=E&&(e.cancelMove(),e.onPathStuck&&"function"===typeof e.onPathStuck))){e.onPathStuck();return}J=g}this.aPathfinderTrajectory.lastTime=Date.now()},16);this.easystar.setAcceptableTiles([0]);this.easystar.disableDiagonals();this.easystar.disableCornerCutting();this.easystar.setGrid([[]]);
p&&(this.easystar.enableDiagonals(),this.easystar.enableCornerCutting());p=VYLO.global.aPathfinder.mapTilesToGrid(this.mapName,q);y=p.acceptedTiles;var F=p.weights;this.easystar.setGrid(p.grid);F.forEach(g=>{e.easystar.setTileCost(g,g)});this.easystar.setAcceptableTiles(y);p=Math.round(this.xPos+this.xOrigin+this.width/2);y=Math.round(this.yPos+this.yOrigin+this.height/2);n=VYLO.global.aPathfinder.clamp(Math.round(VYLO.global.aPathfinder.clamp(n-1,0,z.x))*v.width+v.width/2,0,z.xPos-v.width);u=VYLO.global.aPathfinder.clamp(Math.round(VYLO.global.aPathfinder.clamp(u-
1,0,z.y))*v.height+v.height/2,0,z.yPos-v.height);z=VYLO.Map.getLocByPos(p,y,this.mapName);const D=VYLO.Map.getLocByPos(n,u,this.mapName);var k=VYLO.global.aPathfinder.tileToNode(z);F=VYLO.global.aPathfinder.tileToNode(D);if(VYLO.global.aPathfinder.debugging){const g=VYLO.newDiob("Overlay");g.atlasName="";g.width=v.width;g.height=v.height;g.color={tint:16777215};g.alpha=.7;g.plane=0;g.touchOpacity=0;g.touchOpacity=0;g.setTransition({alpha:0},-1,3E3);D.addOverlay(g);setTimeout(()=>{D.removeOverlay(g)},
3E3)}const M=function(g,w,a,d={left:!1,right:!1,up:!1,down:!1},h){if(g){let m={},x={};for(let c=1;7>c;c++){const b=VYLO.Map.getLocByPos(w-c*v.width/2,a,e.mapName),t=VYLO.Map.getLocByPos(w+c*v.width/2,a,e.mapName),B=VYLO.Map.getLocByPos(w,a-c*v.height/2,e.mapName),A=VYLO.Map.getLocByPos(w,a+c*v.height/2,e.mapName);!b||d.left||b.density&&!q.includes(b)||b.getContents().filter(r=>{const H=h?VYLO.global.aPathfinder.within(e.yPos+e.yOrigin+e.height,r.yPos+r.yOrigin,r.yOrigin+r.height):!0;if(r.density&&
!q.includes(r)&&H)return r.density}).length?(b&&(x[b.id]=b),1>=c&&(d.left=!0)):m[b.id]=b;!t||d.right||t.density&&!q.includes(t)||t.getContents().filter(r=>{const H=h?VYLO.global.aPathfinder.within(e.yPos+e.yOrigin+e.height,r.yPos+r.yOrigin,r.yOrigin+r.height):!0;if(r.density&&!q.includes(r)&&H)return r.density}).length?(t&&(x[t.id]=t),1>=c&&(d.right=!0)):m[t.id]=t;!B||d.up||B.density&&!q.includes(B)||B.getContents().filter(r=>{const H=h?VYLO.global.aPathfinder.within(e.xPos+e.xOrigin+e.width,r.xPos+
r.xOrigin,r.xOrigin+r.width):!0;if(r.density&&!q.includes(r)&&H)return r.density}).length?(B&&(x[B.id]=B),1>=c&&(d.up=!0)):m[B.id]=B;!A||d.down||A.density&&!q.includes(A)||A.getContents().filter(r=>{const H=h?VYLO.global.aPathfinder.within(e.xPos+e.xOrigin+e.width,r.xPos+r.xOrigin,r.xOrigin+r.width):!0;if(r.density&&!q.includes(r)&&H)return r.density}).length?(A&&(x[A.id]=A),1>=c&&(d.down=!0)):m[A.id]=A}let f;if(VYLO.global.aPathfinder.debugging)for(const c in x){const b=VYLO.newDiob("Overlay");b.color=
{tint:16711680};b.atlasName="";b.width=v.width;b.height=v.height;b.color={tint:h?16753920:16711680};b.alpha=.3;b.plane=0;b.mouseOpacity=0;b.touchOpacity=0;b.setTransition({alpha:0},-1,3E3);x[c].addOverlay(b);setTimeout(()=>{x[c].removeOverlay(b)},3E3)}for(const c in m){if(VYLO.global.aPathfinder.debugging){const b=VYLO.newDiob("Overlay");b.color={tint:16711680};b.atlasName="";b.width=v.width;b.height=v.height;b.color={tint:h?8900331:65280};b.alpha=.3;b.plane=0;b.mouseOpacity=0;b.touchOpacity=0;b.setTransition({alpha:0},
-1,3E3);m[c].addOverlay(b);setTimeout(()=>{m[c].removeOverlay(b)},3E3)}w=VYLO.global.aPathfinder.tileToNode(m[c]);f?(a=VYLO.global.aPathfinder.getDistance(g,f),VYLO.global.aPathfinder.getDistance(g,w)<a&&(f=w)):f=w}return f?f:g}},K=function(g,w,a,d,h){var m=g.xPos+g.xOrigin+g.width/2;g=g.yPos+g.yOrigin+g.height/2;return{left:d<=m&&w>=m,right:d>=m&&w<=m,up:h<=g&&a>=g,down:h>=g&&a<=g}};if(z&&(z.density&&!q.includes(z)||z.getContents().filter(g=>{if(g.density&&!q.includes(g))return g.density}).length)){let g,
w={left:!1,right:!1,up:!1,down:!1};if(l){for(var C of z.getContents())C.density&&(g=K(C,p,y,n,u),g.left&&(w.left=!0),g.right&&(w.right=!0),g.up&&(w.up=!0),g.down&&(w.down=!0));C=M(k,p,y,w,!0);w.left&&(k=VYLO.Map.getLocByPos(p+v.width/2,y,e.mapName))&&(k.density&&!q.includes(k)||k.getContents().filter(a=>{if(a.density&&!q.includes(a))return a.density}).length)&&C.x++;w.right&&(k=VYLO.Map.getLocByPos(p-v.width/2,y,e.mapName))&&(k.density&&!q.includes(k)||k.getContents().filter(a=>{if(a.density&&!q.includes(a))return a.density}).length)&&
C.x--;w.up&&(k=VYLO.Map.getLocByPos(p,y+v.height/2,e.mapName))&&(k.density&&!q.includes(k)||k.getContents().filter(a=>{if(a.density&&!q.includes(a))return a.density}).length)&&C.y++;w.down&&(p=VYLO.Map.getLocByPos(p,y-v.height/2,e.mapName))&&(p.density&&!q.includes(p)||p.getContents().filter(a=>{if(a.density&&!q.includes(a))return a.density}).length)&&C.y--;k=C}if(!l||w.left&&w.right&&w.up&&w.down){if(VYLO.global.aPathfinder.debugging){const a=VYLO.newDiob("Overlay");a.atlasName="";a.width=v.width;
a.height=v.height;a.color={tint:16711680};a.alpha=.7;a.plane=0;a.touchOpacity=0;a.touchOpacity=0;a.setTransition({alpha:0},-1,3E3);z.addOverlay(a);setTimeout(()=>{D.removeOverlay(a)},3E3)}if(e.onPathNotFound&&"function"===typeof e.onPathNotFound)e.onPathNotFound(z);e.cancelMove();return}}if(D&&(D.density&&!q.includes(D)||D.getContents().filter(g=>{if(g.density&&!q.includes(g))return g.density}).length)&&(l&&(F=C=M(F,n,u)),!l)){if(e.onPathNotFound&&"function"===typeof e.onPathNotFound)e.onPathNotFound(D);
VYLO.global.aPathfinder.debugging&&D.getOverlays().filter(g=>{g.color={tint:16711680}});e.cancelMove();return}return this.aPathfinderID=this.easystar.findPath(k.x,k.y,F.x,F.y,g=>{if(g&&g.length){g=g.map(a=>{++a.x;++a.y;return a});const w=[...g].reverse();g.shift();e.aPathfinderPath=g;e.aPathfinderPathReversed=w;if(e.onPathFound&&"function"===typeof e.onPathFound)e.onPathFound([...g],[...w])}else if(!g||!g.length){if(e.onPathNotFound&&"function"===typeof e.onPathNotFound)e.onPathNotFound();e.cancelMove()}e.easystar.collisionGrid=
void 0})}console.error("aPathfinder: No mapName was found on this diob.")};I.storedMapTiles={};I.cachedResourcesInfo={};I.clamp=(n,u,p)=>Math.max(u,Math.min(n,p));I.within=function(n,u,p){return n>=u&&n<=p};I.getAngle=function(n,u){return Math.atan2(n.y-u.y,n.x-u.x)-Math.PI};I.getDistance=(n,u)=>{const p=n.y-u.y;n=n.x-u.x;return Math.sqrt(n*n+p*p)};I.getDirFromAngle=function(n){return"east northeast north northwest west southwest south southeast".split(" ")[Math.floor(180/Math.PI*n/45+.5)%8]};I.toTwoDimensionalArray=
function(n,u){let p=0;const l=[];for(;p<n.length;)l.push(n.slice(p,p+=u));return l};I.mapTilesToGrid=function(n,u){if(n){if(VYLO.Map.getMaps().includes(n)){let p;const l=[0],q=[],z=VYLO.Map.getMapSize(n);this.storedMapTiles[n]?p=[...this.storedMapTiles[n].tiles]:(p=VYLO.Map.getTiles(n),this.storedMapTiles[n]={tiles:[...p],tiles2d:this.toTwoDimensionalArray([...p],z.x)});p.forEach((y,F)=>{let k=!y.aPathfindingWeight&&0!==y.aPathfindingWeight||"number"!==typeof y.aPathfindingWeight?0:y.aPathfindingWeight;
u.includes(y)&&(k=k?k:0);y.density&&!u.includes(y)&&(k=1);for(const C of y.getContents()){if(C.density&&!u.includes(C)){k=1;break}C.aPathfindingWeight&&"number"===typeof C.aPathfindingWeight&&(k+=C.aPathfindingWeight)}l.includes(k)||1===k||(l.push(k),q.push(k));p[F]=k});return{acceptedTiles:l,grid:this.toTwoDimensionalArray(p,z.x),weights:q}}console.error("aPathfinder: That mapname was not found.")}else console.error("aPathfinder: No mapname was passed.")};I.getIndexOf2DArray=function(n,u){for(let p=
0;p<n.length;p++){let l=n[p].indexOf(u);if(-1<l)return[p,l]}};I.tileToNode=function(n){if(n&&n.mapName){if(this.storedMapTiles[n.mapName])return n=this.getIndexOf2DArray(this.storedMapTiles[n.mapName].tiles2d,n),{x:n[1],y:n[0]};console.error("aPathfinder: There is no stored grid for the map this tile belongs to.")}};I.nodeToTile=function(n,u){return VYLO.Map.getLoc(u.x+1,u.y+1,n)};I.toggleDebug=function(){this.debugging=!this.debugging}})();